---
title: "EOSC573 data analysis"
output: html_notebook
---


```{r}
library(tidyverse)
library(ggplot2)
library(purrr)
library(RADanalysis)
library(vegan)
library(patchwork)
```

(Methods) Table: Key features
(Methods) Image: Sample sites highlighted on map

Abundance graphs
  Species
  Classes

Relative composition stacked bar graphs
  Species
  Classes

Size structure (Biovolume) => NBSS (normalised biomass size structure) as per paper: ___?
  Biovolume/m^3 (um^3/m^3)
  
Biomass graphs
  Biomass between sites overall
  Biomass % composition stacked bars
  Biomass large (5+mm) vs med (2-5mm) vs small (0-2mm) between groups

Diversity stuff
  Rank Abundance + quantitative comparisons for each site
  Shannon Div Index for each site
  Species eveness for each site

```{r}
#Abundance and species comp
densitiessites <- read.csv("~/Desktop/densitysites.csv", row.names = 1)

density_plot <- densitiessites%>%
  ggplot(aes(x = rownames(densitiessites), y = Average.Density))+
  geom_bar(stat = 'identity', colour = "steelblue", fill = "steelblue")+
  labs(x = "Sites in Barkley Sound",
       y = "Zooplankton Density (ind/m^3)",
       title = "Zooplankton Abundance in Barkley Sound")+
  theme(plot.title = element_text(hjust = 0.5))

ggsave(here::here("density_plot.png"), height = 9, width = 12)
  
  
speciespercent <- read.csv("~/Desktop/speciescomposition.csv", row.names = 1)
compositiongroups <- read.csv("~/Desktop/compositiongorups.csv", row.names = 1)


```


```{r}
#Size histograms
sizebins <- read.csv("~/Desktop/sizes.csv")

srsize_plot <- sizebins %>%
  ggplot(aes(x = X , y = SR))+
  geom_bar(stat = 'identity', position = 'dodge', colour = "steelblue", fill = "steelblue")+
  labs(x = 'Body Length Size Classes',
       y = "Proportion of Individuals (%)",
       title = 'Site SR1 at Sarita River',
       subtitle = '30m tow depth'
       )+
  theme(plot.title = element_text(hjust = 0.5), plot.subtitle = element_text(hjust = 0.5))

n1size_plot <- sizebins %>%
  ggplot(aes(x = X , y = N1))+
  geom_bar(stat = 'identity', position = 'dodge', colour = "steelblue", fill = "steelblue")+
  labs(x = 'Body Length Size Classes',
       y = "Proportion of Individuals (%)",
       title = 'Site N1 in Trevor Channel',
       subtitle = '30m tow depth'
       )+
  theme(plot.title = element_text(hjust = 0.5), plot.subtitle = element_text(hjust = 0.5))

d2size_plot <- sizebins %>%
  ggplot(aes(x = X , y = D2))+
  geom_bar(stat = 'identity', position = 'dodge', colour = "steelblue", fill = "steelblue")+
  labs(x = 'Body Length Size Classes',
       y = "Proportion of Individuals (%)",
       title = 'Site D2 in Trevor Channel',
       subtitle = '60m tow depth'
       )+
  theme(plot.title = element_text(hjust = 0.5), plot.subtitle = element_text(hjust = 0.5))

d1size_plot <- sizebins %>%
  ggplot(aes(x = X , y = D1))+
  geom_bar(stat = 'identity', position = 'dodge', colour = "steelblue", fill = "steelblue")+
  labs(x = 'Body Length Size Classes',
       y = "Proportion of Individuals (%)",
       title = 'Site D1 in Trevor Channel',
       subtitle = '120m tow depth'
       )+
  theme(plot.title = element_text(hjust = 0.5), plot.subtitle = element_text(hjust = 0.5))

plot_comp <- srsize_plot + n1size_plot + d2size_plot + d1size_plot
plot_final <- plot_comp + plot_annotation(tag_levels = "A")
ggsave(here::here("size_plots.png"), height = 9, width = 18) 

```


```{r}
###Biomass
biomasspercenttaxa <- read.csv("~/Desktop/biomass-percent.csv", row.names = 1)
biomassvaluesgroup <- read.csv("~/Desktop/biomassvalues.csv", row.names = 1)
biomasspercentgroups <- read.csv("~/Desktop/biomasspercentgroups.csv", row.names = 1)



```


```{r}
#Diversity data and graphs

#d1data below
d1counts <- read.csv("~/Desktop/d1counts.csv", row.names = 1)
d1div <- diversity(d1counts)
d1even <- d1div/(log(23))

#d2databelow
d2counts <- read.csv("~/Desktop/d2counts.csv", row.names = 1)
d2div <- diversity(d2counts)
d2even <- d2div/(log(19))

#n1databelow
n1counts <- read.csv("~/Desktop/n1counts.csv", row.names = 1)
n1div <- diversity(n1counts)
n1even <- n1div/(log(18))

#srdatabelow
srcounts <- read.csv("~/Desktop/srcounts.csv", row.names = 1)
srdiv <- diversity(srcounts)
sreven <- srdiv/(log(17))

#make dataframe and rename columns

a <- list(srdiv, n1div, d2div, d1div)
b <- list(sreven, n1even, d2even, d1even)

df <- tibble(a, b)
colnames1 <- c("Shannon-Weaver Diversity Index", "Pielou's Species Evenness")
rownames1 <- c("SR", "N1", "D2", "D1")
colnames(df) <- colnames1
rownames(df) <- rownames1

library(ggplot2)
ggplot(df, aes(x = rownames(df), y = df$`Shannon-Weaver Diversity Index`)+
  geom_bar(stat = 'identity')
beez
```


