---
title: "EOSC573 data analysis"
output: r_notebook
---


```{r}
library(tidyverse)
library(ggplot2)
library(purrr)
library(RADanalysis)
library(vegan)
library(patchwork)
library(ggthemes)
```

(Methods) Table: Key features
(Methods) Image: Sample sites highlighted on map

Abundance graphs
  Species
  Classes

Relative composition stacked bar graphs
  Species
  Classes
  
Biomass graphs
  Biomass between sites overall
  Biomass % composition stacked bars
  Biomass large (5+mm) vs med (2-5mm) vs small (0-2mm) between groups

Diversity stuff (table)
  Shannon Div Index for each site
  Species evenness for each site

Plus size histograms

```{r}
#Abundance and species comp
densitiessites <- read.csv("~/Desktop/densitysites.csv", row.names = 1)
densitiessites2<- tibble::rownames_to_column(densitiessites, "Site")

density_plot2 <- densitiessites2%>%
  ggplot(aes(x = Site, y = Average.Density))+
  geom_bar(stat = 'identity', colour = "steelblue", fill = "steelblue")+
  labs(x = "Sites in Barkley Sound",
       y = "Zooplankton Density (ind/m^3)",
       title = "Zooplankton Abundance in Barkley Sound")+
  theme(plot.title = element_text(hjust = 0.5))+
  scale_x_discrete(limits=rev)
density_plot2

ggsave(here::here("density_plot2.png"), height = 9, width = 12)


# species comp
speciespercent <- read.csv("~/Desktop/speciescomposition.csv", row.names = 1)

speciespercent2 <- tibble::rownames_to_column(speciespercent, "Species name")
speciespercent2 <- speciespercent2 %>%
  pivot_longer(!`Species name`, names_to = "Site", values_to = "Count")

#Custom colour palette

mycolours = c(brewer.pal(name="Set2", n=8), brewer.pal(name="Paired", n=12), brewer.pal(name="Set3", n=12))

speciescomp_plot <- speciespercent2 %>%
  ggplot(aes(fill = `Species name`, x = Site, y = Count)) + 
    geom_bar(position="fill", stat="identity")+
  labs(x = "Site",
       y = "Proportion of Sample",
       title = "Species Composition of Zooplankton in Barkley Sound")+
  theme(plot.title = element_text(hjust = 0.5))+
  #scale_fill_excel_new("Office Theme")+
  #scale_fill_viridis(discrete = TRUE, option = "C")+
  scale_x_discrete(limits=rev)+
  scale_fill_manual(values = mycolours)

speciescomp_plot

ggsave(here::here("speciescomp_plot.png"), height = 9, width = 12)

#species comp by group

compositiongroups <- read.csv("~/Desktop/compositiongorups.csv", row.names = 1)

compositiongroups2 <- tibble::rownames_to_column(compositiongroups, "Taxon")
compositiongroups2$N1 <- as.double(compositiongroups2$N1)
compositiongroups2 <- compositiongroups2 %>%
  pivot_longer(!`Taxon`, names_to = "Site", values_to = "Count")


groupcomp_plot <- compositiongroups2 %>%
  ggplot(aes(fill = `Taxon`, x = Site, y = Count)) + 
    geom_bar(position="fill", stat="identity")+
  labs(x = "Site",
       y = "Proportion of Sample",
       title = "Taxon Composition of Zooplankton in Barkley Sound")+
  theme(plot.title = element_text(hjust = 0.5))+
  #scale_fill_excel_new("Office Theme")+
  #scale_fill_viridis(discrete = TRUE, option = "C")+
  scale_x_discrete(limits=rev)+
  scale_fill_manual(values = mycolours)
groupcomp_plot

ggsave(here::here("groupcomp_plot.png"), height = 9, width = 12)


```


```{r}
#Size histograms
sizebins <- read.csv("~/Desktop/sizes.csv")

srsize_plot <- sizebins %>%
  ggplot(aes(x = X , y = SR))+
  geom_bar(stat = 'identity', position = 'dodge', colour = "steelblue", fill = "steelblue")+
  labs(x = 'Body Length Size Classes',
       y = "Proportion of Individuals (%)",
       title = 'Site SR1 at Sarita River',
       subtitle = '30m tow depth'
       )+
  theme(plot.title = element_text(hjust = 0.5), plot.subtitle = element_text(hjust = 0.5))

n1size_plot <- sizebins %>%
  ggplot(aes(x = X , y = N1))+
  geom_bar(stat = 'identity', position = 'dodge', colour = "steelblue", fill = "steelblue")+
  labs(x = 'Body Length Size Classes',
       y = "Proportion of Individuals (%)",
       title = 'Site N1 in Trevor Channel',
       subtitle = '30m tow depth'
       )+
  theme(plot.title = element_text(hjust = 0.5), plot.subtitle = element_text(hjust = 0.5))

d2size_plot <- sizebins %>%
  ggplot(aes(x = X , y = D2))+
  geom_bar(stat = 'identity', position = 'dodge', colour = "steelblue", fill = "steelblue")+
  labs(x = 'Body Length Size Classes',
       y = "Proportion of Individuals (%)",
       title = 'Site D2 in Trevor Channel',
       subtitle = '60m tow depth'
       )+
  theme(plot.title = element_text(hjust = 0.5), plot.subtitle = element_text(hjust = 0.5))

d1size_plot <- sizebins %>%
  ggplot(aes(x = X , y = D1))+
  geom_bar(stat = 'identity', position = 'dodge', colour = "steelblue", fill = "steelblue")+
  labs(x = 'Body Length Size Classes',
       y = "Proportion of Individuals (%)",
       title = 'Site D1 in Trevor Channel',
       subtitle = '120m tow depth'
       )+
  theme(plot.title = element_text(hjust = 0.5), plot.subtitle = element_text(hjust = 0.5))

plot_comp <- srsize_plot + n1size_plot + d2size_plot + d1size_plot
plot_final <- plot_comp + plot_annotation(tag_levels = "A")
ggsave(here::here("size_plots.png"), height = 9, width = 18) 

```


```{r}
###Biomass
biomasspercenttaxa <- read.csv("~/Desktop/biomass-percent.csv", row.names = 1)
biomassvaluesgroup <- read.csv("~/Desktop/biomassvalues.csv", row.names = 1)
biomasspercentgroups <- read.csv("~/Desktop/biomasspercentgroups.csv", row.names = 1)

#Biomass percent by taxa


biomasspercentspecies <- tibble::rownames_to_column(biomasspercenttaxa, "Species")
#compositiongroups2$N1 <- as.double(compositiongroups2$N1)
biomasspercentspecies <- biomasspercentspecies %>%
  pivot_longer(!`Species`, names_to = "Site", values_to = "Count")


species_plot <- biomasspercentspecies %>%
  ggplot(aes(fill = `Species`, x = Site, y = Count)) + 
    geom_bar(position="fill", stat="identity")+
  labs(x = "Site",
       y = "Proportion of Sample",
       fill = "Species name",
       title = "Zooplankton Biomass in Barkley Sound")+
  theme(plot.title = element_text(hjust = 0.5))+
  #scale_fill_excel_new("Office Theme")+
  #scale_fill_viridis(discrete = TRUE, option = "C")+
  scale_x_discrete(limits=rev)+
  scale_fill_manual(values = mycolours)
species_plot

ggsave(here::here("biomassspecies_plot.png"), height = 9, width = 12)

#Biomass stacked bar group

biomassvaluesgroup <- tibble::rownames_to_column(biomassvaluesgroup, "Taxon")
biomassvaluesgroup <- biomassvaluesgroup %>%
  pivot_longer(!`Taxon`, names_to = "Site", values_to = "Count")
view(biomassvaluesgroup)


biomassvalues_plot <- biomassvaluesgroup %>%
  ggplot(aes(fill = `Taxon`, x = Site, y = Count)) + 
    geom_bar(stat = "identity")+
  labs(x = "Site",
       y = "Biomass (mgC/m^3)",
       fill = "Taxon name",
       title = "Zooplankton Biomass in Barkley Sound")+
  theme(plot.title = element_text(hjust = 0.5))+
  #scale_fill_excel_new("Office Theme")+
  #scale_fill_viridis(discrete = TRUE, option = "C")+
  scale_x_discrete(limits=rev)+
  scale_fill_manual(values = mycolours)
biomassvalues_plot

ggsave(here::here("biomassvalues_plot.png"), height = 9, width = 12)


#Biomass percent comp group
view(biomasspercentgroups)




```


```{r}
#Diversity data to dataframe

#d1data below
d1counts <- read.csv("~/Desktop/d1counts.csv", row.names = 1)
d1div <- diversity(d1counts)
d1even <- d1div/(log(23))

#d2databelow
d2counts <- read.csv("~/Desktop/d2counts.csv", row.names = 1)
d2div <- diversity(d2counts)
d2even <- d2div/(log(19))

#n1databelow
n1counts <- read.csv("~/Desktop/n1counts.csv", row.names = 1)
n1div <- diversity(n1counts)
n1even <- n1div/(log(18))

#srdatabelow
srcounts <- read.csv("~/Desktop/srcounts.csv", row.names = 1)
srdiv <- diversity(srcounts)
sreven <- srdiv/(log(17))

#make dataframe and rename columns

a <- list(srdiv, n1div, d2div, d1div)
b <- list(sreven, n1even, d2even, d1even)

df <- tibble(a, b)
colnames1 <- c("Shannon-Weaver Diversity Index", "Pielou's Species Evenness")
rownames1 <- c("SR", "N1", "D2", "D1")
colnames(df) <- colnames1
rownames(df) <- rownames1

```


